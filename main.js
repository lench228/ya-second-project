(()=>{"use strict";var e=function(e,t){var n=t.submitButtonSelector,r=t.submitButtonInactiveClass,o=e.querySelector(n);e.checkValidity()?(o.removeAttribute("disabled"),o.classList.remove(r)):(o.setAttribute("disabled",!0),o.classList.add(r))},t={baseUrl:"https://nomoreparties.co/v1/frontend-st-cohort-201",headers:{authorization:"1a9d1eca-3f6b-4cef-9232-0e22b5dc9124","Content-Type":"application/json"}},n=".card__like_button",r="card__like_button_is-active",o=".card",c=function(e,t,o){var c=e.querySelector(n);e.querySelector(".card__like_counter").textContent=t.likes.length,t.likes.some((function(e){return e._id===o}))?c.classList.add(r):c.classList.remove(r)},a=function(e,a,u,i,s){var l=a.content.cloneNode(!0),d=l.firstElementChild,f=l.querySelector(".card__image"),p=l.querySelector(".card__title");f.src=e.link,p.textContent=e.name,d.setAttribute("id",e._id),f.addEventListener("click",(function(){return u(e)}));var m=l.querySelector(".card__delete-button");return e.owner._id!==s?m.style.display="none":m.addEventListener("click",(function(e){return function(e){var n;(n=e.currentTarget.closest(o).id,fetch("".concat(t.baseUrl,"/cards/").concat(n),{headers:t.headers,method:"DELETE"}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(){window.location.reload()})).catch((function(e){console.log(e)}))}(e)})),function(e,a,u){c(e,a,u),e.querySelector(n).addEventListener("click",(function(e){return function(e,n,a){var u,i=e.currentTarget,s=document.getElementById(i.closest(o).id);i.classList.contains(r)?(u=n,fetch("".concat(t.baseUrl,"/cards/likes/").concat(u),{headers:t.headers,method:"DELETE"}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){c(s,e,a)})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{headers:t.headers,method:"PUT"}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(n).then((function(e){c(s,e,a)})).catch((function(e){console.log(e)}))}(e,a._id,u)}))}(l,e,s),l},u="popup_is-opened",i=function(e){document.body.addEventListener("keydown",l),e.classList.add(u)},s=function(e){document.body.removeEventListener("keydown",l),e.classList.remove(u)};document.body.addEventListener("click",(function(e){return function(e){e.target.classList.contains(u)&&e.target.classList.remove(u)}(e)}));var l=function(e){if("Escape"===e.key){var t=document.querySelector("."+u);s(t)}},d=document.querySelector(".profile__title"),f=document.querySelector(".profile__description"),p=document.querySelector(".profile__image"),m=document.querySelector(".profile__edit-button"),v=document.querySelector(".popup_type_edit"),y=v.querySelector(".popup__form"),h=y.elements.name,_=y.elements.description,b=function(e,t,n){d.textContent=e,f.textContent=t,p.style.backgroundImage="url(".concat(n,")")},S=fetch("".concat(t.baseUrl,"/users/me"),{headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return b(e.name,e.about,e.avatar),e})).catch((function(e){d.textContent=e,f.textContent="",p.style.backgroundImage=""}));m.addEventListener("click",(function(){return e=d.textContent,t=f.textContent,h.value=e,_.value=t,void i(v);var e,t})),y.addEventListener("submit",(function(e){e.preventDefault();var n,r,o=e.currentTarget.querySelector(".button");o.textContent="Сохранение...",o.disabled=!0,(n=h.value,r=_.value,fetch("".concat(t.baseUrl,"/users/me"),{headers:t.headers,body:JSON.stringify({name:n,about:r}),method:"PATCH"}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){var t=e.name,n=e.about,r=e.avatar;b(t,n,r)})).catch((function(e){console.log(e)})).finally((function(){o.disabled=!1,o.textContent="Сохранить"})),s(v)}));var g=document.querySelector(".popup_type_avatar"),k=document.querySelector(".profile__image"),q=g.querySelector(".popup__form");function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var E,L,P,x=document.querySelector("#card-template"),j=document.querySelector(".places__list"),A={profilePopup:v,cardPopup:document.querySelector(".popup_type_new-card"),imagePopup:document.querySelector(".popup_type_image"),avatarPopup:g},T=document.querySelector(".profile__add-button"),U=A.cardPopup.querySelector(".popup__form"),w=U.elements["place-name"],I=U.elements.link,O=document.querySelector(".popup__caption"),M=document.querySelector(".popup__image"),B=function(e){O.textContent=e.name,M.src=e.link,i(A.imagePopup)},D=function(e,t,n){e.textContent=t,e.disabled=n};P="",Object.values(A).forEach((function(e){var t=e.querySelector(".popup__close");e.classList.add("popup_is-animated"),t.addEventListener("click",(function(){return s(e)}))})),Promise.all([S(),fetch("".concat(t.baseUrl,"/cards"),{headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))]).then((function(e){var t,n,r=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,c,a,u=[],i=!0,s=!1;try{if(c=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;i=!1}else for(;!(i=(r=c.call(n)).done)&&(u.push(r.value),u.length!==t);i=!0);}catch(e){s=!0,o=e}finally{try{if(!i&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(s)throw o}}return u}}(t,n)||function(e,t){if(e){if("string"==typeof e)return C(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?C(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=r[0],c=r[1];P=o._id,c.forEach((function(e){return function(e,t){var n=a(e,x,B,0,t);j.appendChild(n)}(e,P)}))})).catch((function(e){return console.error(e)})),L=(E={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",submitButtonInactiveClass:"popup__button_inactive",inputErrorClass:"popup__input_error",errorActiveClass:"popup__error_active",errorSelectorPrefix:".popup__error_",errors:{valueMissing:"Вы пропустили это поле",tooShort:"Слишком мало символов",typeMismatch:"Введите url",default:"Ошибка."}}).formSelector,Array.from(document.querySelectorAll(L)).forEach((function(t){(function(t,n){var r=n.inputSelector;Array.from(t.querySelectorAll(r)).forEach((function(r){r.addEventListener("input",(function(){!function(t,n,r){n.validity.valid?function(e,t,n){var r=n.inputErrorClass,o=n.errorActiveClass,c=n.errorSelectorPrefix,a=e.querySelector("".concat(c).concat(t.name));t.classList.remove(r),a.classList.remove(o),a.textContent=""}(t,n,r):function(e,t,n,r){var o=r.inputErrorClass,c=r.errorSelectorPrefix,a=r.errors,u=r.errorActiveClass,i=e.querySelector("".concat(c).concat(t.name));t.classList.add(o),n.valueMissing?i.textContent=a.valueMissing:n.tooShort?i.textContent=a.tooShort:n.typeMismatch?i.textContent=a.typeMismatch:i.textContent=a.default,i.classList.add(u)}(t,n,n.validity,r),e(t,r)}(t,r,n)}))}))})(t,E),e(t,E)})),k.addEventListener("click",(function(e){i(g)})),q.addEventListener("submit",(function(e){!function(e){e.preventDefault();var n,r=e.currentTarget,o=r.querySelector(".button");o.textContent="Сохранение...",o.disabled=!0,(n=r.elements["avatar-link"].value,fetch("".concat(t.baseUrl,"/users/me/avatar"),{headers:t.headers,method:"PATCH",body:JSON.stringify({avatar:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){k.style.backgroundImage="url("+e.avatar+")"})).catch((function(e){console.log(e)})).finally((function(){o.textContent="Сохранить",o.disabled=!1}))}(e)})),U.addEventListener("submit",(function(e){return function(e,n){e.preventDefault();var r,o,c=e.currentTarget,u=c.querySelector(".button");D(u,"Сохранение...",!0),(r=c.elements.name,o=c.elements.link,fetch("".concat(t.baseUrl,"/cards "),{headers:t.headers,body:JSON.stringify({name:r,link:o}),method:"POST"}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){var t=a(e,x,B,0,n);j.prepend(t),s(A.cardPopup)})).catch((function(e){console.log(e)})).finally((function(){D(u,"Сохранить",!1)}))}(e,P)})),T.addEventListener("click",(function(){w.value="",I.value="",i(A.cardPopup)}))})();